<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>POS Barra - Churros</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/pos.css') }}">

    <style>
      /* ===== FEEDBACK PRODUCTOS ===== */
      .product-btn.active {
        background: #198754 !important;
        border-color: #198754 !important;
        transform: scale(1.03);
      }

      .product-badge {
        position: absolute;
        top: 8px;
        right: 12px;
        background: #ffc107;
        color: #000;
        font-weight: bold;
        border-radius: 20px;
        padding: 2px 8px;
        font-size: 13px;
      }

      /* ===== HISTORIAL ===== */
      .card-header {
        cursor: pointer;
        user-select: none;
      }

      /* ===== BOT√ìN BLOQUEADO ===== */
      #submitOrder:disabled {
        opacity: .6;
        cursor: not-allowed;
      }
    </style>
</head>

<body class="bg-light">
<div class="container-fluid p-3">

    <h2 class="mb-3">üç© POS Barra</h2>

    <!-- Datos -->
    <div class="row mb-3">
        <div class="col-md-4">
            <label>Nombre cliente</label>
            <input id="referenceName" class="form-control form-control-lg" placeholder="Ej: Juan">
        </div>

        <div class="col-md-4">
            <label>Forma de pago</label>
            <select id="paymentMethod" class="form-select form-select-lg">
                <option value="Efectivo">Efectivo</option>
                <option value="Transferencia">Transferencia</option>
            </select>
        </div>

        <div class="col-md-4">
            <label>Paga con</label>
            <input id="paidAmount" type="number" class="form-control form-control-lg" placeholder="Ej: 5000">
        </div>
    </div>

    <div class="row">
        <!-- Productos -->
        <div class="col-md-7">
            <h4>Productos</h4>
            <div id="products" class="row g-3 position-relative"></div>
        </div>

        <!-- Pedido -->
        <div class="col-md-5">
            <h4>Pedido</h4>
            <ul id="orderList" class="list-group mb-3"></ul>

            <div class="p-3 bg-light rounded mb-3">
                <h5>Total: $<span id="pedidoTotal">0</span></h5>
                <h6>Vuelto: $<span id="pedidoVuelto">0</span></h6>
                <small class="text-danger d-none" id="payHint">
                  ‚ö†Ô∏è El monto pagado es insuficiente
                </small>
            </div>

            <button id="submitOrder" class="btn btn-success btn-lg w-100" disabled>
                üí∞ Cobrar y Enviar
            </button>
        </div>
    </div>

    <!-- HISTORIAL -->
    <div class="row mt-4">
        <div class="col-md-7">
            <div class="card">
                <div class="card-header" id="toggleHistory">
                    üßæ √öltimos pedidos
                </div>
                <div class="card-body p-2" id="historyBody" style="max-height:220px; overflow-y:auto;">
                    <table class="table table-sm mb-0">
                        <thead>
                            <tr>
                                <th>Hora</th>
                                <th>Cliente</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody id="historialBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-5"></div>
    </div>

</div>

<!-- MODALES Y AUDIO (SIN CAMBIOS) -->
<!-- MODAL DETALLE PEDIDO -->
<div class="modal fade" id="orderDetailModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content rounded-4 shadow">

      <div class="modal-header bg-light">
        <h5 class="modal-title fw-bold">üßæ Detalle del pedido</h5>
        <button class="btn-close" data-bs-dismiss="modal"></button>
      </div>

      <div class="modal-body">

        <div class="row mb-3">
          <div class="col-md-6">
            <div class="text-muted small">Cliente</div>
            <div class="fw-semibold" id="detailCustomer"></div>
          </div>
          <div class="col-md-6 text-md-end">
            <div class="text-muted small">Fecha</div>
            <div class="fw-semibold" id="detailDate"></div>
          </div>
        </div>

        <div class="table-responsive">
          <table class="table table-sm align-middle">
            <thead class="table-light">
              <tr>
                <th>Producto</th>
                <th class="text-center">Cant.</th>
                <th class="text-end">Precio</th>
                <th class="text-end">Subtotal</th>
              </tr>
            </thead>
            <tbody id="detailItems"></tbody>
          </table>
        </div>

        <div class="d-flex justify-content-end mt-3">
          <div class="fs-5 fw-bold">
            Total: $<span id="detailTotal"></span>
          </div>
        </div>

      </div>

      <div class="modal-footer d-flex justify-content-between">
        <button class="btn btn-outline-danger" id="btnCancelOrder">
          ‚ùå Anular pedido
        </button>

        <button class="btn btn-primary" id="btnPrintTicket">
          üñ®Ô∏è Imprimir ticket (QR)
        </button>
      </div>

    </div>
  </div>
</div>

<audio id="successSound" preload="auto">
  <source src="/static/sounds/success.mp3" type="audio/mpeg">
</audio>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="{{ url_for('static', filename='js/pos.js') }}"></script>

</body>
</html>
